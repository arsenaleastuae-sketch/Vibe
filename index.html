<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>360 Cocktails</title>
  <style>
    html, body { height: 100%; margin: 0; }
    #pano { position: fixed; inset: 0; background: #000; }

    /* Hotspot (коктейльная точка) */
    .hotspot {
      width: 22px; height: 22px;
      border-radius: 999px;
      background: rgba(255,255,255,0.9);
      box-shadow: 0 0 0 0 rgba(255,255,255,0.6);
      cursor: pointer;
      transform: translate(-50%, -50%);
      position: relative;
    }
    .hotspot::after {
      content:"";
      position:absolute; inset:-10px;
      border-radius:999px;
      border: 2px solid rgba(255,255,255,0.55);
      animation: pulse 1.6s infinite;
    }
    @keyframes pulse {
      0%   { transform: scale(0.6); opacity: 0.8; }
      70%  { transform: scale(1.1); opacity: 0; }
      100% { transform: scale(1.1); opacity: 0; }
    }

    /* Popup */
    #cocktailModalBackdrop {
      position: fixed; inset: 0;
      background: rgba(0,0,0,0.45);
      display: none;
      align-items: center;
      justify-content: center;
      padding: 16px;
    }
    #cocktailModal {
      width: min(520px, 100%);
      background: rgba(255,255,255,0.95);
      border-radius: 18px;
      overflow: hidden;
      box-shadow: 0 20px 60px rgba(0,0,0,0.35);
      backdrop-filter: blur(10px);
    }
    #cocktailModalHeader {
      display:flex; justify-content: space-between; align-items:center;
      padding: 14px 16px;
      border-bottom: 1px solid rgba(0,0,0,0.08);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
    }
    #cocktailModalHeader h3 { margin:0; font-size: 16px; }
    #closeBtn {
      border: none; background: transparent; cursor:pointer;
      font-size: 22px; line-height: 1; padding: 4px 8px;
    }
    #cocktailBody {
      display: grid;
      grid-template-columns: 160px 1fr;
      gap: 12px;
      padding: 16px;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
    }
    #cocktailImg {
      width: 160px; height: 160px; object-fit: cover;
      border-radius: 14px;
      background: #eee;
    }
    #cocktailDesc { margin: 0 0 10px 0; font-size: 14px; line-height: 1.4; color: #222; }
    #cocktailMeta { font-size: 12px; color: #555; margin: 0 0 12px 0; }
    #cocktailActions { display:flex; gap:10px; }
    .btn {
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid rgba(0,0,0,0.12);
      background: white;
      cursor:pointer;
      text-decoration:none;
      color:#111;
      font-size: 13px;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      flex: 1;
    }
    .btnPrimary {
      border-color: rgba(0,0,0,0.0);
      background: #111;
      color: #fff;
    }

    @media (max-width: 420px) {
      #cocktailBody { grid-template-columns: 1fr; }
      #cocktailImg { width: 100%; height: 200px; }
    }
  </style>
</head>
<body>
  <div id="pano"></div>

  <!-- Popup -->
  <div id="cocktailModalBackdrop">
    <div id="cocktailModal" role="dialog" aria-modal="true">
      <div id="cocktailModalHeader">
        <h3 id="cocktailTitle">Коктейль</h3>
        <button id="closeBtn" aria-label="Закрыть">×</button>
      </div>
      <div id="cocktailBody">
        <img id="cocktailImg" alt="" />
        <div>
          <p id="cocktailDesc"></p>
          <p id="cocktailMeta"></p>
          <div id="cocktailActions">
            <a id="moreLink" class="btn" href="#" target="_blank" rel="noopener">Подробнее</a>
            <a id="orderLink" class="btn btnPrimary" href="#">Заказать</a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Marzipano (подключи файл библиотеки локально или с вашего CDN) -->
  <script src="marzipano.js"></script>
  <script>
    // 1) Данные коктейлей (можно вынести в JSON)
    const cocktails = [
      {
        id: "negroni",
        title: "Negroni",
        desc: "Классический горько-сладкий коктейль на джине с кампари и вермутом.",
        meta: "Крепость: ~24% • 120 мл • Лёд: кубики",
        image: "images/negroni.jpg",
        moreUrl: "https://example.com/negroni",
        orderUrl: "https://example.com/order?item=negroni",
        // Координаты hotspot (yaw/pitch) — подбираются при кликах (см. ниже)
        yaw: -1.35,
        pitch: -0.05
      },
      {
        id: "spritz",
        title: "Aperol Spritz",
        desc: "Лёгкий аперитив: игристое + апероль + содовая. Идеален для террасы.",
        meta: "Крепость: ~11% • 200 мл • Гарнир: апельсин",
        image: "images/spritz.jpg",
        moreUrl: "https://example.com/spritz",
        orderUrl: "https://example.com/order?item=spritz",
        yaw: 1.05,
        pitch: -0.10
      }
    ];

    // 2) Инициализация просмотра
    const panoElement = document.getElementById("pano");
    const viewer = new Marzipano.Viewer(panoElement);

    const source = Marzipano.ImageUrlSource.fromString("panos/Terrace.jpg");
    const geometry = new Marzipano.EquirectGeometry([{ width: 4096 }]);

    const limiter = Marzipano.util.compose(
      Marzipano.RectilinearView.limit.traditional(1024, 120*Math.PI/180),
      Marzipano.RectilinearView.limit.vfov(30*Math.PI/180, 110*Math.PI/180)
    );
    const view = new Marzipano.RectilinearView({ yaw: 0, pitch: 0, fov: 90*Math.PI/180 }, limiter);

    const scene = viewer.createScene({ source, geometry, view, pinFirstLevel: true });
    scene.switchTo();

    // 3) Popup helpers
    const backdrop = document.getElementById("cocktailModalBackdrop");
    const closeBtn = document.getElementById("closeBtn");
    const titleEl = document.getElementById("cocktailTitle");
    const descEl = document.getElementById("cocktailDesc");
    const metaEl = document.getElementById("cocktailMeta");
    const imgEl = document.getElementById("cocktailImg");
    const moreLink = document.getElementById("moreLink");
    const orderLink = document.getElementById("orderLink");

    function openModal(c) {
      titleEl.textContent = c.title;
      descEl.textContent = c.desc;
      metaEl.textContent = c.meta || "";
      imgEl.src = c.image || "";
      imgEl.alt = c.title;

      // Ссылки (можно заменить на вашу логику заказа)
      moreLink.href = c.moreUrl || "#";
      orderLink.href = c.orderUrl || "#";

      backdrop.style.display = "flex";
    }
    function closeModal() { backdrop.style.display = "none"; }

    closeBtn.addEventListener("click", closeModal);
    backdrop.addEventListener("click", (e) => { if (e.target === backdrop) closeModal(); });
    document.addEventListener("keydown", (e) => { if (e.key === "Escape") closeModal(); });

    // 4) Создание hotspot’ов
    cocktails.forEach((c) => {
      const el = document.createElement("div");
      el.className = "hotspot";
      el.title = c.title;

      el.addEventListener("click", (e) => {
        e.stopPropagation();
        openModal(c);
      });

      scene.hotspotContainer().createHotspot(el, { yaw: c.yaw, pitch: c.pitch });
    });

    // 5) Фишка для настройки: кликай по панораме — в консоль выведутся yaw/pitch
    // Этим удобно “поймать” точные места коктейлей.
    panoElement.addEventListener("click", () => {
      const yaw = view.yaw();
      const pitch = view.pitch();
      console.log("Current view yaw/pitch:", yaw.toFixed(4), pitch.toFixed(4));
    });
  </script>
</body>
</html>
